<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Match Blend</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #121212;
            color: #fff;
        }
        .container {
            text-align: center;
        }
        h1 {
            color: #1DB954;
            margin-bottom: 20px;
        }
        .login-button {
            padding: 12px 24px;
            background-color: #1DB954;
            color: #fff;
            text-decoration: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer; /* Makes it clear the element is clickable */
            transition: transform 0.3s ease-in-out, background-color 0.3s ease;
        }
        .login-button:hover {
            background-color: #179340;
            transform: scale(1.1); /* This makes the button 10% larger */
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="login-section">
            <h1>Welcome to Spotify Match Blend</h1>
            <p>Find your music match and start chatting!</p>
            <a href="/login" class="login-button">Log in with Spotify</a>
        </div>
        <div id="app-section" class="hidden">
            <h1>Logged in!</h1>
            <p>Find your perfect match to get started.</p>
            <button id="match-button" class="login-button">Find My Match</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            // FIXED: Changed 'access_token' to 'token' to match your backend
            const token = params.get('token');
            
            const loginSection = document.getElementById('login-section');
            const appSection = document.getElementById('app-section');
            const matchButton = document.getElementById('match-button');
            
            if (token) {
                // User is logged in
                loginSection.classList.add('hidden');
                appSection.classList.remove('hidden');
                
                // Optional: Clean up the URL by removing the token so it looks nicer
                window.history.replaceState({}, document.title, "/");
                
                matchButton.addEventListener('click', () => {
                    // Send a request to your server's /api/match endpoint
                    // FIXED: Added Authorization header which is the standard way to send JWTs
                    fetch('/api/match', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    })
                        .then(response => response.json())
                        .then(data => {
                            // Display the match result to the user
                            if (data.match) {
                                alert(`You matched with: ${data.match}`);
                            } else {
                                alert(data.message || 'No match found. Invite your friends!');
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching match:', error);
                            alert('Failed to find a match.');
                        });
                });

            } else {
                // User is not logged in, show login button
                loginSection.classList.remove('hidden');
                appSection.classList.add('hidden');
            }
        });
    </script>